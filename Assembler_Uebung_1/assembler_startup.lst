


ARM Macro Assembler    Page 1 


    1 00000000         ;*******************************************************
                       *************
    2 00000000         ;* htw saar - Fakultaet fuer Ingenieurwissenschaften    
                       *
    3 00000000         ;* Labor fuer Eingebettete Systeme         *
    4 00000000         ;* Mikroprozessortechnik           *
    5 00000000         ;*******************************************************
                       *************
    6 00000000         ;* Assembler_Startup.S:            *
    7 00000000         ;* Programmrumpf fuer Assembler-Programme mit dem Keil  
                         *
    8 00000000         ;* Entwicklungsprogramm uVision fuer ARM-Mikrocontroller
                          *
    9 00000000         ;*******************************************************
                       *************
   10 00000000         ;* Aufgabe-Nr.: 2 Laborversuch 1                     *
   11 00000000         ;*                 *             *
   12 00000000         ;*******************************************************
                       *************
   13 00000000         ;* Gruppen-Nr.:    *          *
   14 00000000         ;*                 *          *
   15 00000000         ;*******************************************************
                       *************
   16 00000000         ;* Name / Matrikel-Nr.:   *          *
   17 00000000         ;*        *          *
   18 00000000         ;*       *          *
   19 00000000         ;*******************************************************
                       *************
   20 00000000         ;* Abgabedatum:    *                     *
   21 00000000         ;* 18.12.2025    *          *
   22 00000000         ;*******************************************************
                       *************
   23 00000000 38E38E39 
                       DIV_9   EQU              0x38E38E39  ; mit n=1
   24 00000000 CCCCCCCD 
                       DIV_10  EQU              0xCCCCCCCD  ; mit n=3
   25 00000000         ;*******************************************************
                       *************
   26 00000000         ;* Daten-Bereich bzw. Daten-Speicher                 *
   27 00000000         ;*******************************************************
                       *************
   28 00000000                 AREA             Daten, DATA, READWRITE
   29 00000000         Datenanfang
   30 00000000 00000000 
                       X       EQU              Datenanfang
   31 00000000 00000800 
                       Top_Stack
                               EQU              Datenanfang + 0x800
   32 00000000 00000800 
                       Datenende
                               EQU              Top_Stack
   33 00000000         ;*******************************************************
                       *************
   34 00000000         ;* Programm-Bereich bzw. Programm-Speicher       *
   35 00000000         ;*******************************************************
                       *************
   36 00000000                 AREA             Programm, CODE, READONLY
   37 00000000                 ARM
   38 00000000 E321F010 



ARM Macro Assembler    Page 2 


                       Reset_Handler
                               MSR              CPSR_c, #0x10 ; User Mode aktiv
                                                            ieren, Reset Handle
                                                            r bereitet Programm
                                                            start vor und ist d
                                                            ie erste Zeile Code
                                                             die ausgeführt wir
                                                            d, initialisiert u.
                                                             a. SP
   39 00000004         ;*******************************************************
                       *************
   40 00000004         ;* Hier das eigene (Haupt-)Programm einfuegen        *
   41 00000004         ;*******************************************************
                       *************
   42 00000004 E59FD0DC        LDR              SP, =Top_Stack
   43 00000008 E59F00DC        LDR              R0, =X      ; R0 = &STRING   !!
                                                            ! '=' liest entwede
                                                            r Adresse von Strin
                                                            g ein, oder bei Kon
                                                            stanten den Wert, s
                                                            . DIV_9
   44 0000000C EB00002F        BL               Berechnungen
   45 00000010         ;*******************************************************
                       *************
   46 00000010         ;* Ende des eigenen (Haupt-)Programms                   
                                   *
   47 00000010         ;*******************************************************
                       *************
   48 00000010 EAFFFFFE 
                       endlos  B                endlos
   49 00000014         
   50 00000014         ;*******************************************************
                       *************
   51 00000014         ;* ab hier Unterprogramme                               
                                   *
   52 00000014         ;*******************************************************
                       *************
   53 00000014 00000030 
                       CHAR_0  EQU              0x30        ; '0'
   54 00000014 0000002B 
                       CHAR_PLUS
                               EQU              0x2B        ; '+'
   55 00000014 0000002D 
                       CHAR_MINUS
                               EQU              0x2D        ; '-'
   56 00000014         
   57 00000014         AtoI
   58 00000014 E92D4000        STMFD            SP!, {LR}
   59 00000018 E3A02000        MOV              R2, #0      ; Zwischenspeicher 
                                                            für Ergebnis / Akku
                                                            
   60 0000001C E3A05000        MOV              R5, #0      ; Status-Flag
   61 00000020         
   62 00000020         ; erstes Zeichen holen
   63 00000020 E5D01000        LDRB             R1, [R0]    ; R1 = *R0, erstes 
                                                            Byte/ 2 HexZahlen
   64 00000024 E351002D        CMP              R1, #CHAR_MINUS ; '-'
   65 00000028 01A05001        MOVEQ            R5, R1      ; Setze Flag in R5 
                                                            bei Minus



ARM Macro Assembler    Page 3 


   66 0000002C         
   67 0000002C 1351002B        CMPNE            R1, #CHAR_PLUS ; '+'
   68 00000030 02800001        ADDEQ            R0, R0, #1  ; Gehe im Register 
                                                            um ein Wort weiter 
                                                              
   69 00000034         
   70 00000034         AtoI_Loop
   71 00000034 E4D01001        LDRB             R1, [R0], #1 
                                                            ; aktuelles Zeichen
                                                            
   72 00000038 E3510000        CMP              R1, #0      ; Stringende
   73 0000003C 0A000004        BEQ              AtoI_End    ; ja -> fertig
   74 00000040         
   75 00000040 E2411030        SUB              R1, R1, #CHAR_0 ; ASCII-Zeichen
                                                             in Ziffer 0..9 umw
                                                            andeln: Zahl = Char
                                                             - 0x30
   76 00000044         
   77 00000044 E1A04182        MOV              R4, R2, LSL #3 ; R4 = result*8 
                                                              LSL #3 = Logical 
                                                            Shift Left mit 2^3 
                                                            = 8, Befehl wird vo
                                                            n Rechts nach links
                                                             ausgeführt, zuerst
                                                             LSL auf R2, dann M
                                                            ove, auch bei Add o
                                                            . Änhlichen
   78 00000048 E0844082        ADD              R4, R4, R2, LSL #1 ; R4 = resul
                                                            t*8 + result*2 = re
                                                            sult*10
   79 0000004C E0842001        ADD              R2, R4, R1  ; result = result*1
                                                            0 + digit
   80 00000050         
   81 00000050         ;ADD     R0, R0, #1   ; nächstes Zeichen, alternativ, da
                        LDRB #1 inkrementiert
   82 00000050 EAFFFFF7        B                AtoI_Loop
   83 00000054         
   84 00000054         AtoI_End
   85 00000054 E3550000        CMP              R5, #0      ; negative Flag prü
                                                            fen
   86 00000058 12622000        RSBNE            R2, R2, #0  ; Reverse Substract
                                                             Not Equals, 0 - R2
                                                            , falls negative Fl
                                                            ag gesetzt ist, um 
                                                            Zahl zu negieren
   87 0000005C         
   88 0000005C E1A00002        MOV              R0, R2      ; Ergebnis in R0 ab
                                                            speichern
   89 00000060 E8BD4000        LDMFD            SP!, {LR}
   90 00000064 E12FFF1E        BX               LR
   91 00000068         
   92 00000068         
   93 00000068         Formel
   94 00000068 E92D4000        STMFD            SP!, {LR}
   95 0000006C E59F107C        LDR              R1, =DIV_9  ; MagicNumber für D
                                                            IV mit 9 wird in R1
                                                             geladen
   96 00000070         
   97 00000070 E0020090        MUL              R2, R0, R0  ; X^2 in R2 abgespe



ARM Macro Assembler    Page 4 


                                                            ichert
   98 00000074 E0843192        UMULL            R3, R4, R2, R1 ; x^2 wird mit M
                                                            agicNumber multipli
                                                            ziert, UMULL anstel
                                                            le von SMULL, da R2
                                                             immer positiv ist,
                                                             da R2 = R0^2 
   99 00000078 E1A030A4        MOV              R3, R4, LSR #1 ; Rechts-Shift u
                                                            m n = 1, s. Skript 
                                                            S. 96 Tabelle 18, d
                                                            amit Ergebnis nicht
                                                             mehr als LONG vorl
                                                            iegt, herunterskali
                                                            eren durch Rechts-S
                                                            hift nach mul mit M
                                                            agicNumber -> LSR #
                                                            1 == * 2^-n, ASR ni
                                                            cht notwendig, da n
                                                            iemals - vorliegt
  100 0000007C E1A00103        MOV              R0, R3, LSL #2 ; Term wird mit 
                                                            2^2 = 4 multiplizie
                                                            rt und in R0 gespei
                                                            chert , R3 low, R4 
                                                            high
  101 00000080         ;Mitunter Rundungfehler, da zuerst geteilt wird und dann
                        multipliziert, Kommazahlen werden immer abgeschnitten B
                       sp: 8/9 = 0
  102 00000080 E8BD4000        LDMFD            SP!, {LR}
  103 00000084 E12FFF1E        BX               LR
  104 00000088         
  105 00000088         
  106 00000088         uItoBCD
  107 00000088 E92D4000        STMFD            SP!, {LR}
  108 0000008C E59F5060        LDR              R5, =DIV_10 ; MagicNumber für D
                                                            IV mit 10 wird in R
                                                            1 geladen
  109 00000090         
  110 00000090 E3A01000        MOV              R1, #0      ; Zwischenergebnis
  111 00000094 E3A02000        MOV              R2, #0      ; Shift-Parameter  
                                                            
  112 00000098         
  113 00000098         uItoBCD_Loop
  114 00000098 E3500000        CMP              R0, #0      ; Prüft ob R0 ferti
                                                            g ist
  115 0000009C 0A000008        BEQ              uItoBCD_Done
  116 000000A0         
  117 000000A0 E0863590        UMULL            R3, R6, R0, R5 
                                                            ; R5 == Konstante
  118 000000A4 E1A031A6        MOV              R3, R6, LSR #3 ; q = R0 / 10 mi
                                                            t MagicNumber von R
                                                            5 und Shift um 3
  119 000000A8         
  120 000000A8 E1A04183        MOV              R4, R3, LSL #3
  121 000000AC E0844083        ADD              R4, R4, R3, LSL #1 ; R4 = q * 1
                                                            0 -> Modulo Rechnun
                                                            g Bsp.: 12/10 = 1 -
                                                            > 1*10 = 10 -> 12-1
                                                            0 = 2 == Rest
  122 000000B0         



ARM Macro Assembler    Page 5 


  123 000000B0 E0404004        SUB              R4, R0, R4  ; rest = R0 - q * 1
                                                            0 == R0 - R4
  124 000000B4         
  125 000000B4         ;MOV  R7, R4, LSL R2 ; Ergebnis wird um R2 nach Links ge
                       shifted und in R7 gespeichert um BCD zu bauen
  126 000000B4 E0811214        ADD              R1, R1, R4, LSL R2 ; Ergebnis +
                                                            = R7 Egal ob ADD, E
                                                            OR order ORR, da di
                                                            e Anzahl an Nullste
                                                            llen
  127 000000B8         
  128 000000B8 E1A00003        MOV              R0, R3      ; Zwischenergebnis 
                                                            für Modulorechnung 
                                                            in R0 schreiben
  129 000000BC E2822004        ADD              R2, R2, #4  ; R2 - Shiftamount 
                                                            um 4 erhöhen -> ein
                                                            e Hex-Stelle weiter
                                                             shiften
  130 000000C0         
  131 000000C0 EAFFFFF4        B                uItoBCD_Loop
  132 000000C4         
  133 000000C4         uItoBCD_Done
  134 000000C4 E1A00001        MOV              R0, R1
  135 000000C8 E8BD4000        LDMFD            SP!, {LR}
  136 000000CC E12FFF1E        BX               LR
  137 000000D0         
  138 000000D0         
  139 000000D0         Berechnungen
  140 000000D0 E92D4000        STMFD            SP!, {LR}   ; Store Multiple Fu
                                                            ll Descending, PUSH
                                                            , Full Descending -
                                                             Stack Pointer SP z
                                                            eigt immer auf letz
                                                            tes belegtes Elemen
                                                            t, Stack wächst von
                                                             hohen zu niedrigen
                                                             Speicheradressen
  141 000000D4         
  142 000000D4 EBFFFFCE        BL               AtoI        ; Branch with Link,
                                                             merkt sich den Urs
                                                            prung des branches 
                                                            in LR, im gegensatz
                                                             zu 'B'
  143 000000D8         
  144 000000D8 EBFFFFE2        BL               Formel      ; Aufruf von Unterp
                                                            rogramm Formel
  145 000000DC         
  146 000000DC EBFFFFE9        BL               uItoBCD     ; Aufruf von Unterp
                                                            rogramm uItoBCD
  147 000000E0         
  148 000000E0 E8BD4000        LDMFD            SP!, {LR}   ; Load Multiple Ful
                                                            l Descending, POP
  149 000000E4         
  150 000000E4 E12FFF1E        BX               LR          ; BX = Branch and E
                                                            xchange, Exchange u
                                                            m u.a. in Thumb Mod
                                                            us wechseln zu könn
                                                            en, B kann nur Labe
                                                            l wie 'uItoBCD' les



ARM Macro Assembler    Page 6 


                                                            en und offset berec
                                                            hnen, aber keine re
                                                            gister wie 'LR', de
                                                            shalb BX LR um aus 
                                                            Unterprogramm zu ve
                                                            rlassen
  151 000000E8         
  152 000000E8         
  153 000000E8         ;*******************************************************
                       *************
  154 000000E8         ;* Konstanten im CODE-Bereich                           
                                   *
  155 000000E8         ;*******************************************************
                       *************
  156 000000E8         ;*******************************************************
                       *************
  157 000000E8         ;* Ende der Programm-Quelle                             
                                   *
  158 000000E8         ;*******************************************************
                       *************
  159 000000E8                 END
              00000000 
              00000000 
              38E38E39 
              CCCCCCCD 
Command Line: --debug --xref --depend=.\assembler_startup.d -o.\assembler_start
up.o -IC:\Keil\ARM\RV31\INC -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\Inc\Phili
ps --predefine="__EVAL SETA 1" --list=.\assembler_startup.lst Assembler_Startup
.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

Daten 00000000

Symbol: Daten
   Definitions
      At line 28 in file Assembler_Startup.s
   Uses
      None
Comment: Daten unused
Datenanfang 00000000

Symbol: Datenanfang
   Definitions
      At line 29 in file Assembler_Startup.s
   Uses
      At line 30 in file Assembler_Startup.s
      At line 31 in file Assembler_Startup.s

Datenende 00000800

Symbol: Datenende
   Definitions
      At line 32 in file Assembler_Startup.s
   Uses
      None
Comment: Datenende unused
Top_Stack 00000800

Symbol: Top_Stack
   Definitions
      At line 31 in file Assembler_Startup.s
   Uses
      At line 32 in file Assembler_Startup.s
      At line 42 in file Assembler_Startup.s

X 00000000

Symbol: X
   Definitions
      At line 30 in file Assembler_Startup.s
   Uses
      At line 43 in file Assembler_Startup.s
Comment: X used once
5 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

AtoI 00000014

Symbol: AtoI
   Definitions
      At line 57 in file Assembler_Startup.s
   Uses
      At line 142 in file Assembler_Startup.s
Comment: AtoI used once
AtoI_End 00000054

Symbol: AtoI_End
   Definitions
      At line 84 in file Assembler_Startup.s
   Uses
      At line 73 in file Assembler_Startup.s
Comment: AtoI_End used once
AtoI_Loop 00000034

Symbol: AtoI_Loop
   Definitions
      At line 70 in file Assembler_Startup.s
   Uses
      At line 82 in file Assembler_Startup.s
Comment: AtoI_Loop used once
Berechnungen 000000D0

Symbol: Berechnungen
   Definitions
      At line 139 in file Assembler_Startup.s
   Uses
      At line 44 in file Assembler_Startup.s
Comment: Berechnungen used once
Formel 00000068

Symbol: Formel
   Definitions
      At line 93 in file Assembler_Startup.s
   Uses
      At line 144 in file Assembler_Startup.s
Comment: Formel used once
Programm 00000000

Symbol: Programm
   Definitions
      At line 36 in file Assembler_Startup.s
   Uses
      None
Comment: Programm unused
Reset_Handler 00000000

Symbol: Reset_Handler
   Definitions
      At line 38 in file Assembler_Startup.s
   Uses
      None
Comment: Reset_Handler unused
endlos 00000010

Symbol: endlos



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 48 in file Assembler_Startup.s
   Uses
      At line 48 in file Assembler_Startup.s
Comment: endlos used once
uItoBCD 00000088

Symbol: uItoBCD
   Definitions
      At line 106 in file Assembler_Startup.s
   Uses
      At line 146 in file Assembler_Startup.s
Comment: uItoBCD used once
uItoBCD_Done 000000C4

Symbol: uItoBCD_Done
   Definitions
      At line 133 in file Assembler_Startup.s
   Uses
      At line 115 in file Assembler_Startup.s
Comment: uItoBCD_Done used once
uItoBCD_Loop 00000098

Symbol: uItoBCD_Loop
   Definitions
      At line 113 in file Assembler_Startup.s
   Uses
      At line 131 in file Assembler_Startup.s
Comment: uItoBCD_Loop used once
11 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

CHAR_0 00000030

Symbol: CHAR_0
   Definitions
      At line 53 in file Assembler_Startup.s
   Uses
      At line 75 in file Assembler_Startup.s
Comment: CHAR_0 used once
CHAR_MINUS 0000002D

Symbol: CHAR_MINUS
   Definitions
      At line 55 in file Assembler_Startup.s
   Uses
      At line 64 in file Assembler_Startup.s
Comment: CHAR_MINUS used once
CHAR_PLUS 0000002B

Symbol: CHAR_PLUS
   Definitions
      At line 54 in file Assembler_Startup.s
   Uses
      At line 67 in file Assembler_Startup.s
Comment: CHAR_PLUS used once
DIV_10 CCCCCCCD

Symbol: DIV_10
   Definitions
      At line 24 in file Assembler_Startup.s
   Uses
      At line 108 in file Assembler_Startup.s
Comment: DIV_10 used once
DIV_9 38E38E39

Symbol: DIV_9
   Definitions
      At line 23 in file Assembler_Startup.s
   Uses
      At line 95 in file Assembler_Startup.s
Comment: DIV_9 used once
5 symbols
354 symbols in table
