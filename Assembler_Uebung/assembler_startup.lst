


ARM Macro Assembler    Page 1 


    1 00000000         ;*******************************************************
                       *************
    2 00000000         ;* htw saar - Fakultaet fuer Ingenieurwissenschaften    
                       *
    3 00000000         ;* Labor fuer Eingebettete Systeme         *
    4 00000000         ;* Mikroprozessortechnik           *
    5 00000000         ;*******************************************************
                       *************
    6 00000000         ;* Assembler_Startup.S:            *
    7 00000000         ;* Programmrumpf fuer Assembler-Programme mit dem Keil  
                         *
    8 00000000         ;* Entwicklungsprogramm uVision fuer ARM-Mikrocontroller
                          *
    9 00000000         ;*******************************************************
                       *************
   10 00000000         ;* Aufgabe-Nr.: 2 Laborversuch 1                     *
   11 00000000         ;*                 *             *
   12 00000000         ;*******************************************************
                       *************
   13 00000000         ;* Gruppen-Nr.: 8   *          *
   14 00000000         ;*                 *          *
   15 00000000         ;*******************************************************
                       *************
   16 00000000         ;* Name / Matrikel-Nr.:   *          *
   17 00000000         ;* Eric Lorenc / 5013021 *            *
   18 00000000         ;*       *          *
   19 00000000         ;*******************************************************
                       *************
   20 00000000         ;* Abgabedatum:    *                     *
   21 00000000         ;* 18.12.2025    *          *
   22 00000000         ;*******************************************************
                       *************^
   23 00000000 38E38E39 
                       DIV_9   EQU              0x38E38E39  ; mit n=1
   24 00000000 CCCCCCCD 
                       DIV_10  EQU              0xCCCCCCCD  ; mit n=3
   25 00000000         ;*******************************************************
                       *************
   26 00000000         ;* Daten-Bereich bzw. Daten-Speicher                 *
   27 00000000         ;*******************************************************
                       *************
   28 00000000                 AREA             Daten, DATA, READWRITE
   29 00000000         Datenanfang
   30 00000000         ;*******************************************************
                       *************
   31 00000000         ;* Programm-Bereich bzw. Programm-Speicher       *
   32 00000000         ;*******************************************************
                       *************
   33 00000000                 AREA             Programm, CODE, READONLY
   34 00000000                 ARM
   35 00000000 E321F010 
                       Reset_Handler
                               MSR              CPSR_c, #0x10 ; User Mode aktiv
                                                            ieren, Reset Handle
                                                            r bereitet Programm
                                                            start vor und ist d
                                                            ie erste Zeile Code
                                                             die ausgeführt wir
                                                            d, initialisiert u.



ARM Macro Assembler    Page 2 


                                                             a. SP
   36 00000004         ;*******************************************************
                       *************
   37 00000004         ;* Hier das eigene (Haupt-)Programm einfuegen        *
   38 00000004         ;*******************************************************
                       *************
   39 00000004 EB00002E        BL               Berechnungen
   40 00000008         ;*******************************************************
                       *************
   41 00000008         ;* Ende des eigenen (Haupt-)Programms                   
                                   *
   42 00000008         ;*******************************************************
                       *************
   43 00000008 EAFFFFFE 
                       endlos  B                endlos
   44 0000000C         
   45 0000000C         ;*******************************************************
                       *************
   46 0000000C         ;* ab hier Unterprogramme                               
                                   *
   47 0000000C         ;*******************************************************
                       *************
   48 0000000C 00000030 
                       CHAR_0  EQU              0x30        ; '0'
   49 0000000C 0000002B 
                       CHAR_PLUS
                               EQU              0x2B        ; '+'
   50 0000000C 0000002D 
                       CHAR_MINUS
                               EQU              0x2D        ; '-'
   51 0000000C         
   52 0000000C         AtoI
   53 0000000C E92D4000        STMFD            SP!, {LR}
   54 00000010 E3A02000        MOV              R2, #0
   55 00000014 E3A05000        MOV              R5, #0
   56 00000018         
   57 00000018         ; erstes Zeichen holen
   58 00000018 E5D01000        LDRB             R1, [R0]    ; R1 = *R0, erstes 
                                                            Byte/ 2 HexZahlen
   59 0000001C E351002D        CMP              R1, #CHAR_MINUS ; '-'
   60 00000020 01A05001        MOVEQ            R5, R1      ; Setze Flag in R5 
                                                            bei Minus
   61 00000024         
   62 00000024 1351002B        CMPNE            R1, #CHAR_PLUS ; '+'
   63 00000028 02800001        ADDEQ            R0, R0, #1  ; Gehe im Register 
                                                            um ein Wort weiter 
                                                              
   64 0000002C         
   65 0000002C         AtoI_Loop
   66 0000002C E4D01001        LDRB             R1, [R0], #1 
                                                            ; aktuelles Zeichen
                                                            
   67 00000030 E3510000        CMP              R1, #0      ; Stringende
   68 00000034 0A000004        BEQ              AtoI_End    ; ja -> fertig
   69 00000038         
   70 00000038 E2411030        SUB              R1, R1, #CHAR_0 ; ASCII-Zeichen
                                                             in Ziffer 0..9 umw
                                                            andeln: Zahl = Char
                                                             - 0x30



ARM Macro Assembler    Page 3 


   71 0000003C         
   72 0000003C E1A04182        MOV              R4, R2, LSL #3 ; R4 = result*8 
                                                              LSL #3 = Logical 
                                                            Shift Left mit 2^3 
                                                            = 8, Befehl wird vo
                                                            n Rechts nach links
                                                             ausgeführt, zuerst
                                                             LSL auf R2, dann M
                                                            ove, auch bei Add o
                                                            . Änhlichen
   73 00000040 E0844082        ADD              R4, R4, R2, LSL #1 ; R4 = resul
                                                            t*8 + result*2 = re
                                                            sult*10
   74 00000044 E0842001        ADD              R2, R4, R1  ; result = result*1
                                                            0 + digit
   75 00000048         
   76 00000048         ;ADD     R0, R0, #1   ; nächstes Zeichen, alternativ, da
                        LDRB #1 inkrementiert
   77 00000048 EAFFFFF7        B                AtoI_Loop
   78 0000004C         
   79 0000004C         AtoI_End
   80 0000004C E3550000        CMP              R5, #0      ; negative Flag prü
                                                            fen
   81 00000050 12622000        RSBNE            R2, R2, #0  ; Reverse Substract
                                                             Not Equals, 0 - R2
                                                            , falls negative Fl
                                                            ag gesetzt ist, um 
                                                            Zahl zu negieren
   82 00000054         
   83 00000054 E1A00002        MOV              R0, R2      ; Ergebnis in R0 ab
                                                            speichern
   84 00000058 E8BD4000        LDMFD            SP!, {LR}
   85 0000005C E12FFF1E        BX               LR
   86 00000060         
   87 00000060         
   88 00000060         Formel
   89 00000060 E92D4000        STMFD            SP!, {LR}
   90 00000064 E0020090        MUL              R2, R0, R0  ; X^2 in R2 abgespe
                                                            ichert
   91 00000068 E0843192        UMULL            R3, R4, R2, R1 ; x^2 wird mit M
                                                            agicNumber multipli
                                                            ziert, UMULL anstel
                                                            le von SMULL, da R2
                                                             immer positiv ist,
                                                             da R2 = R0^2 
   92 0000006C E1A030A4        MOV              R3, R4, LSR #1 ; Rechts-Shift u
                                                            m n = 1, s. Skript 
                                                            S. 96 Tabelle 18, d
                                                            amit Ergebnis nicht
                                                             mehr als LONG vorl
                                                            iegt, herunterskali
                                                            eren durch Rechts-S
                                                            hift nach mul mit M
                                                            agicNumber -> LSR #
                                                            1 == * 2^-n, ASR ni
                                                            cht notwendig, da n
                                                            iemals - vorliegt
   93 00000070 E1A00103        MOV              R0, R3, LSL #2 ; Term wird mit 
                                                            2^2 = 4 multiplizie



ARM Macro Assembler    Page 4 


                                                            rt und in R0 gespei
                                                            chert , R3 low, R4 
                                                            high
   94 00000074         ;Mitunter Rundungfehler, da zuerst geteilt wird und dann
                        multipliziert, Kommazahlen werden immer abgeschnitten B
                       sp: 8/9 = 0
   95 00000074 E8BD4000        LDMFD            SP!, {LR}
   96 00000078 E12FFF1E        BX               LR
   97 0000007C         
   98 0000007C         
   99 0000007C         uItoBCD
  100 0000007C E92D4000        STMFD            SP!, {LR}
  101 00000080 E3A01000        MOV              R1, #0      ; Zwischenergebnis
  102 00000084 E3A02000        MOV              R2, #0      ; Shift-Parameter  
                                                            
  103 00000088         
  104 00000088         uItoBCD_Loop
  105 00000088 E3500000        CMP              R0, #0      ; Prüft ob R0 ferti
                                                            g ist
  106 0000008C 0A000009        BEQ              uItoBCD_Done
  107 00000090         
  108 00000090 E0863590        UMULL            R3, R6, R0, R5 
                                                            ; R5 == Konstante
  109 00000094 E1A031A6        MOV              R3, R6, LSR #3 ; q = R0 / 10 mi
                                                            t MagicNumber von R
                                                            5 und Shift um 3
  110 00000098         
  111 00000098 E1A04183        MOV              R4, R3, LSL #3
  112 0000009C E0844083        ADD              R4, R4, R3, LSL #1 ; R4 = q * 1
                                                            0 -> Modulo Rechnun
                                                            g Bsp.: 12/10 = 1 -
                                                            > 1*10 = 10 -> 12-1
                                                            0 = 2 == Rest
  113 000000A0         
  114 000000A0 E0404004        SUB              R4, R0, R4  ; rest = R0 - q * 1
                                                            0 == R0 - R4
  115 000000A4         
  116 000000A4 E1A07214        MOV              R7, R4, LSL R2 ; Ergebnis wird 
                                                            um R2 nach Links ge
                                                            shifted und in R7 g
                                                            espeichert um BCD z
                                                            u bauen
  117 000000A8 E0811007        ADD              R1, R1, R7  ; Ergebnis += R7 Eg
                                                            al ob ADD, EOR orde
                                                            r ORR, da die Anzah
                                                            l an Nullstellen
  118 000000AC         
  119 000000AC E1A00003        MOV              R0, R3      ; Zwischenergebnis 
                                                            für Modulorechnung 
                                                            in R0 schreiben
  120 000000B0 E2822004        ADD              R2, R2, #4  ; R2 - Shiftamount 
                                                            um 4 erhöhen -> ein
                                                            e Hex-Stelle weiter
                                                             shiften
  121 000000B4         
  122 000000B4 EAFFFFF3        B                uItoBCD_Loop
  123 000000B8         
  124 000000B8         uItoBCD_Done
  125 000000B8 E1A00001        MOV              R0, R1



ARM Macro Assembler    Page 5 


  126 000000BC E8BD4000        LDMFD            SP!, {LR}
  127 000000C0 E12FFF1E        BX               LR
  128 000000C4         
  129 000000C4         
  130 000000C4         Berechnungen
  131 000000C4 E92D4000        STMFD            SP!, {LR}   ; Store Multiple Fu
                                                            ll Descending, PUSH
                                                            , Full Descending -
                                                             Stack Pointer SP z
                                                            eigt immer auf letz
                                                            tes belegtes Elemen
                                                            t, Stack wächst von
                                                             hohen zu niedrigen
                                                             Speicheradressen
  132 000000C8         
  133 000000C8 E59F001C        LDR              R0, =STRING ; R0 = &STRING   !!
                                                            ! '=' liest entwede
                                                            r Adresse von Strin
                                                            g ein, oder bei Kon
                                                            stanten den Wert, s
                                                            . DIV_9
  134 000000CC EBFFFFCE        BL               AtoI        ; Branch with Link,
                                                             merkt sich den Urs
                                                            prung des branches 
                                                            in LR, im gegensatz
                                                             zu 'B'
  135 000000D0         
  136 000000D0 E59F1018        LDR              R1, =DIV_9  ; MagicNumber für D
                                                            IV mit 9 wird in R1
                                                             geladen
  137 000000D4 EBFFFFE1        BL               Formel      ; Aufruf von Unterp
                                                            rogramm Formel
  138 000000D8         
  139 000000D8 E59F5014        LDR              R5, =DIV_10 ; MagicNumber für D
                                                            IV mit 10 wird in R
                                                            1 geladen
  140 000000DC EBFFFFE6        BL               uItoBCD     ; Aufruf von Unterp
                                                            rogramm uItoBCD
  141 000000E0         
  142 000000E0 E8BD4000        LDMFD            SP!, {LR}   ; Load Multiple Ful
                                                            l Descending, POP
  143 000000E4         
  144 000000E4 E12FFF1E        BX               LR          ; BX = Branch and E
                                                            xchange, Exchange u
                                                            m u.a. in Thumb Mod
                                                            us wechseln zu könn
                                                            en, B kann nur Labe
                                                            l wie 'uItoBCD' les
                                                            en und offset berec
                                                            hnen, aber keine re
                                                            gister wie 'LR', de
                                                            shalb BX LR um aus 
                                                            Unterprogramm zu ve
                                                            rlassen
  145 000000E8         
  146 000000E8         
  147 000000E8         ;*******************************************************
                       *************
  148 000000E8         ;* Konstanten im CODE-Bereich                           



ARM Macro Assembler    Page 6 


                                   *
  149 000000E8         ;*******************************************************
                       *************
  150 000000E8 31 31 30 
              00       STRING  DCB              "110",0x00  ; 'Define Constant 
                                                            Byte', 0-terminiert
                                                            er String
  151 000000EC                 ALIGN                        ; Align hier überfl
                                                            üssig, da nach DCB 
                                                            kein weiterer Wert 
                                                            eingelesen/ geladen
                                                             wird, sonst Align,
                                                             da Adressgrenzen s
                                                            onst nicht stimmen 
                                                            -> Alignment Fault 
                                                            
  152 000000EC         ;*******************************************************
                       *************
  153 000000EC         ;* Ende der Programm-Quelle                             
                                   *
  154 000000EC         ;*******************************************************
                       *************
  155 000000EC                 END
              00000000 
              38E38E39 
              CCCCCCCD 
Command Line: --debug --xref --depend=.\assembler_startup.d -o.\assembler_start
up.o -IC:\Keil\ARM\RV31\INC -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\Inc\Phili
ps --predefine="__EVAL SETA 1" --list=.\assembler_startup.lst Assembler_Startup
.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

Daten 00000000

Symbol: Daten
   Definitions
      At line 28 in file Assembler_Startup.s
   Uses
      None
Comment: Daten unused
Datenanfang 00000000

Symbol: Datenanfang
   Definitions
      At line 29 in file Assembler_Startup.s
   Uses
      None
Comment: Datenanfang unused
2 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

AtoI 0000000C

Symbol: AtoI
   Definitions
      At line 52 in file Assembler_Startup.s
   Uses
      At line 134 in file Assembler_Startup.s
Comment: AtoI used once
AtoI_End 0000004C

Symbol: AtoI_End
   Definitions
      At line 79 in file Assembler_Startup.s
   Uses
      At line 68 in file Assembler_Startup.s
Comment: AtoI_End used once
AtoI_Loop 0000002C

Symbol: AtoI_Loop
   Definitions
      At line 65 in file Assembler_Startup.s
   Uses
      At line 77 in file Assembler_Startup.s
Comment: AtoI_Loop used once
Berechnungen 000000C4

Symbol: Berechnungen
   Definitions
      At line 130 in file Assembler_Startup.s
   Uses
      At line 39 in file Assembler_Startup.s
Comment: Berechnungen used once
Formel 00000060

Symbol: Formel
   Definitions
      At line 88 in file Assembler_Startup.s
   Uses
      At line 137 in file Assembler_Startup.s
Comment: Formel used once
Programm 00000000

Symbol: Programm
   Definitions
      At line 33 in file Assembler_Startup.s
   Uses
      None
Comment: Programm unused
Reset_Handler 00000000

Symbol: Reset_Handler
   Definitions
      At line 35 in file Assembler_Startup.s
   Uses
      None
Comment: Reset_Handler unused
STRING 000000E8

Symbol: STRING



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 150 in file Assembler_Startup.s
   Uses
      At line 133 in file Assembler_Startup.s
Comment: STRING used once
endlos 00000008

Symbol: endlos
   Definitions
      At line 43 in file Assembler_Startup.s
   Uses
      At line 43 in file Assembler_Startup.s
Comment: endlos used once
uItoBCD 0000007C

Symbol: uItoBCD
   Definitions
      At line 99 in file Assembler_Startup.s
   Uses
      At line 140 in file Assembler_Startup.s
Comment: uItoBCD used once
uItoBCD_Done 000000B8

Symbol: uItoBCD_Done
   Definitions
      At line 124 in file Assembler_Startup.s
   Uses
      At line 106 in file Assembler_Startup.s
Comment: uItoBCD_Done used once
uItoBCD_Loop 00000088

Symbol: uItoBCD_Loop
   Definitions
      At line 104 in file Assembler_Startup.s
   Uses
      At line 122 in file Assembler_Startup.s
Comment: uItoBCD_Loop used once
12 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

CHAR_0 00000030

Symbol: CHAR_0
   Definitions
      At line 48 in file Assembler_Startup.s
   Uses
      At line 70 in file Assembler_Startup.s
Comment: CHAR_0 used once
CHAR_MINUS 0000002D

Symbol: CHAR_MINUS
   Definitions
      At line 50 in file Assembler_Startup.s
   Uses
      At line 59 in file Assembler_Startup.s
Comment: CHAR_MINUS used once
CHAR_PLUS 0000002B

Symbol: CHAR_PLUS
   Definitions
      At line 49 in file Assembler_Startup.s
   Uses
      At line 62 in file Assembler_Startup.s
Comment: CHAR_PLUS used once
DIV_10 CCCCCCCD

Symbol: DIV_10
   Definitions
      At line 24 in file Assembler_Startup.s
   Uses
      At line 139 in file Assembler_Startup.s
Comment: DIV_10 used once
DIV_9 38E38E39

Symbol: DIV_9
   Definitions
      At line 23 in file Assembler_Startup.s
   Uses
      At line 136 in file Assembler_Startup.s
Comment: DIV_9 used once
5 symbols
352 symbols in table
